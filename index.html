<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cigarette Tracker</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #ecf0f1;
            --text-color: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .goal-status {
            padding: 0.5rem;
            border-radius: 5px;
            font-weight: bold;
        }

        .goal-exceeded {
            background-color: #ffdddd;
            color: #ff0000;
        }

        .goal-on-track {
            background-color: #ddffdd;
            color: #008000;
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        #chart {
            width: 100%;
            height: 250px;
            margin-top: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        @media (max-width: 480px) {
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="stats">
            <div>
                <p>Today's Cigarettes: <span id="todayCount">0</span></p>
                <p>Daily Goal: <span id="dailyGoal">10</span></p>
            </div>
            <div id="goalStatus" class="goal-status goal-on-track">On Track</div>
        </div>

        <button id="logCigaretteBtn" class="btn">Log Cigarette</button>
        <button id="undoLastBtn" class="btn btn-secondary">Undo Last</button>
    </div>

    <div class="container">
        <h2>Consumption History</h2>
        <div id="chart">No data available</div>
    </div>

    <div class="container action-buttons">
        <button id="setGoalBtn" class="btn">Set Daily Goal</button>
        <button id="resetDataBtn" class="btn btn-danger">Reset All Data</button>
    </div>

    <script>
        // Cigarette Tracker Application
        class CigaretteTracker {
            constructor() {
                // Initialize elements
                this.todayCountEl = document.getElementById('todayCount');
                this.dailyGoalEl = document.getElementById('dailyGoal');
                this.goalStatusEl = document.getElementById('goalStatus');
                this.logCigaretteBtn = document.getElementById('logCigaretteBtn');
                this.undoLastBtn = document.getElementById('undoLastBtn');
                this.setGoalBtn = document.getElementById('setGoalBtn');
                this.resetDataBtn = document.getElementById('resetDataBtn');
                this.chartEl = document.getElementById('chart');

                // Initialize data
                this.cigaretteLog = JSON.parse(localStorage.getItem('cigaretteLog')) || [];
                this.dailyGoal = parseInt(localStorage.getItem('dailyGoal')) || 10;

                // Bind events
                this.bindEvents();

                // Initial render
                this.renderStats();
                this.renderChart();
            }

            bindEvents() {
                this.logCigaretteBtn.addEventListener('click', () => this.logCigarette());
                this.undoLastBtn.addEventListener('click', () => this.undoLastCigarette());
                this.setGoalBtn.addEventListener('click', () => this.setDailyGoal());
                this.resetDataBtn.addEventListener('click', () => this.resetData());
            }

            logCigarette() {
                const now = new Date();
                this.cigaretteLog.push({
                    timestamp: now.toISOString(),
                    date: now.toLocaleDateString()
                });
                this.saveLog();
                this.renderStats();
                this.renderChart();
            }

            undoLastCigarette() {
                if (this.cigaretteLog.length > 0) {
                    this.cigaretteLog.pop();
                    this.saveLog();
                    this.renderStats();
                    this.renderChart();
                }
            }

            setDailyGoal() {
                const newGoal = prompt('Enter your new daily cigarette goal:', this.dailyGoal);
                const parsedGoal = parseInt(newGoal);
                
                if (!isNaN(parsedGoal) && parsedGoal > 0) {
                    this.dailyGoal = parsedGoal;
                    localStorage.setItem('dailyGoal', this.dailyGoal);
                    this.renderStats();
                }
            }

            resetData() {
                if (confirm('Are you sure you want to reset all tracking data?')) {
                    this.cigaretteLog = [];
                    this.saveLog();
                    this.renderStats();
                    this.renderChart();
                }
            }

            saveLog() {
                localStorage.setItem('cigaretteLog', JSON.stringify(this.cigaretteLog));
            }

            renderStats() {
                const today = new Date().toLocaleDateString();
                const todayCigarettes = this.cigaretteLog
                    .filter(entry => new Date(entry.timestamp).toLocaleDateString() === today);

                this.todayCountEl.textContent = todayCigarettes.length;
                this.dailyGoalEl.textContent = this.dailyGoal;

                if (todayCigarettes.length > this.dailyGoal) {
                    this.goalStatusEl.textContent = 'Goal Exceeded';
                    this.goalStatusEl.className = 'goal-status goal-exceeded';
                } else {
                    this.goalStatusEl.textContent = 'On Track';
                    this.goalStatusEl.className = 'goal-status goal-on-track';
                }
            }

            renderChart() {
                const dailyCounts = this.cigaretteLog.reduce((acc, entry) => {
                    const date = new Date(entry.timestamp).toLocaleDateString();
                    acc[date] = (acc[date] || 0) + 1;
                    return acc;
                }, {});

                const chartData = Object.entries(dailyCounts)
                    .map(([date, count]) => `${date}: ${count}`)
                    .join('\n');

                this.chartEl.textContent = chartData || 'No data available';
            }
        }

        // Initialize the tracker
        const tracker = new CigaretteTracker();

        // Basic PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>